openapi: 3.0.3
info:
  title: PriceDrop API
  description: |
    ## Real-time Price Tracking & Monitoring API
    
    Track products from major e-commerce platforms and get instant notifications when prices drop. Monitor price history, set custom alerts, and analyze pricing trends across multiple stores.
    
    ### Key Features:
    - üîç Track products from Amazon, Best Buy, Walmart, Target, and more
    - üìä Historical price data and trend analysis
    - üîî Customizable price drop alerts
    - üìà Price predictions and analytics
    - ‚ö° Real-time price checking
    - üåç Support for international stores
    
    ### Supported Stores:
    - Amazon (US, UK, DE, FR, CA)
    - Best Buy
    - Walmart
    - Target
    - eBay
    - Newegg
    - B&H Photo
    - Home Depot
    - And more...
    
    ### Rate Limits:
    - **Free Plan**: 100 requests/day, 10 products tracked
    - **Basic Plan**: 1,000 requests/day, 100 products tracked
    - **Pro Plan**: 10,000 requests/day, 1,000 products tracked
    - **Enterprise**: Custom limits, unlimited products
    
  version: 1.0.0
  termsOfService: https://pricedrop-api.vercel.app/terms
  contact:
    name: API Support
    email: support@pricedrop-api.com
    url: https://pricedrop-api.vercel.app/support
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://pricedrop-api.vercel.app/api
    description: Production Server
  - url: https://pricedrop-api-staging.vercel.app/api
    description: Staging Server

tags:
  - name: Products
    description: Product tracking and management
  - name: Prices
    description: Price checking and history
  - name: Alerts
    description: Price drop alerts and notifications
  - name: Health
    description: API health and status

paths:
    /v1/core/health:
    get:
      tags:
        - Health
      summary: Get core service health
      description: Retrieve health, uptime, and dependency information for the API service.
      operationId: getCoreHealth
      responses:
        '200':
          description: API health details
          content:
            application/json:
              schema:
                type: object
                properties:
                   success:
                    type: boolean
                    example: true
                status:
                    type: string
                    description: Overall service status derived from dependency checks.
                    enum:
                      - healthy
                      - degraded
                    example: healthy
                timestamp:
                    type: string
                    format: date-time
                    example: 2024-01-15T12:34:56.000Z
                version:
                    type: string
                    example: 1.0.0
                service:
                    type: string
                    example: PriceDrop API
                    checks:
                    type: object
                    additionalProperties:
                      type: string
                    example:
                      api: operational
                      database: operational
                      ebay_api: operational
                      amazon_api: limited
                      rapidapi: configured
                    uptime:
                    type: object
                    properties:
                      seconds:
                        type: number
                        example: 45296.78
                      formatted:
                        type: string
                        example: 0d 12h 34m
                    resources:
                    type: object
                    properties:
                      memory:
                        type: object
                        properties:
                          used:
                            type: string
                            example: 123.45 MB
                          total:
                            type: string
                            example: 256.00 MB
                      cpu:
                        type: object
                        description: Raw CPU usage statistics from Node.js `process.cpuUsage()`.
                    rapidapi:
                    type: object
                    properties:
                      headers_detected:
                        type: object
                        properties:
                          X-RapidAPI-Key:
                            type: boolean
                            example: true
                          X-RapidAPI-Host:
                            type: boolean
                            example: false
                      cors_enabled:
                        type: boolean
                        example: true
                      auth_not_required:
                        type: boolean
                        example: true
                      note:
                        type: string
                        example: This endpoint does not require authentication for testing

    /v1/products/track:
    post:
      tags:
        - Products
      summary: Start tracking a product
      description: Initialize product tracking, price history collection, and alert preferences for a URL.
      operationId: postTrackProduct
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
              properties:
                url:
                  type: string
                  format: uri
                  description: Product URL to track. Currently supports eBay and Amazon links.
                  example: https://www.ebay.com/itm/165123456789
                target_price:
                  type: number
                  format: float
                  nullable: true
                  description: Desired target price to trigger alerts.
                  example: 179.99
                notify_on_drop:
                  type: boolean
                  description: Enable price drop notifications for the tracked product.
                  example: true
                            check_frequency:
                  type: integer
                  description: Number of hours between price checks.
                  example: 2
                user_email:
                  type: string
                  format: email
                  description: Email address used for alert notifications when no user account exists.
                  example: shopper@example.com
      responses:
        '201':
          description: Tracking initialized successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Product tracking initialized successfully
                  tracking:
                    type: object
                    properties:
                      tracking_id:
                        type: string
                        example: ebay-165123456789
                      product_id:
                        type: string
                        example: 550e8400-e29b-41d4-a716-446655440000
                      url:
                        type: string
                        format: uri
                        example: https://www.ebay.com/itm/165123456789
                      platform:
                        type: string
                        example: ebay
                      external_id:
                        type: string
                        nullable: true
                        example: "165123456789"
                      status:
                        type: string
                        example: active
                  product:
                    type: object
                    description: Product record that was created or reused for tracking.
                  alerts:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                        example: true
                      target_price:
                        type: number
                        nullable: true
                        example: 179.99
                      email:
                        type: string
                        nullable: true
                        example: shopper@example.com
                      check_frequency:
                        type: string
                        example: Every 2 hour(s)
                  price_history:
                    type: object
                    properties:
                      count:
                        type: integer
                        example: 3
                      data:
                        type: array
                        items:
                          type: object
                        description: Recent price history records, limited to the most recent ten entries.
                      chart_url:
                        type: string
                        example: /v1/core/prices/history?product_id=550e8400-e29b-41d4-a716-446655440000
                  next_steps:
                    type: object
                    properties:
                      view_product:
                        type: string
                        example: /v1/products/550e8400-e29b-41d4-a716-446655440000
                      update_alert:
                        type: string
                        example: /v1/core/prices/alerts?alert_id=alert_123
                      stop_tracking:
                        type: string
                        example: /v1/products/550e8400-e29b-41d4-a716-446655440000/untrack
        '400':
          description: Invalid or unsupported tracking request
          content:
            application/json:
              examples:
                missingUrl:
                  summary: Product URL missing
                  value:
                    success: false
                    error: Product URL is required
                    code: MISSING_URL
                unsupportedPlatform:
                  summary: Unsupported store URL
                  value:
                    success: false
                    error: Unsupported platform
                    supported:
                      - ebay.com
                      - amazon.com
                    note: More platforms coming soon!
        '500':
          description: Failed to initialize product tracking
          content:
            application/json:
              example:
                success: false
                error: Failed to track product
                message: Unexpected error
                tip: Make sure your environment variables are configured correctly

    /v1/products/{id}:
    get:
      tags:
        - Products
      summary: Get tracked product insights
      description: Fetch product details and pricing insights for the supplied identifier.
      operationId: getProductById
      parameters:
        - name: id
          in: path
          required: true
          description: External marketplace identifier (e.g., eBay item ID) or internal tracking ID.
          schema:
            type: string
            
      responses:
        '200':
          description: Product details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  product:
                    type: object
                    properties:
                      id:
                        type: string
                        example: 165123456789
                      title:
                        type: string
                        example: Limited Edition Gaming Console
                      price:
                        type: object
                        properties:
                        current:
                            type: number
                            example: 249.99
                      insights:
                        type: object
                        properties:
                          price_competitiveness:
                            type: string
                            example: competitive
                          demand_level:
                            type: object
                          seller_reliability:
                            type: object
                          best_time_to_buy:
                            type: object
                      affiliate_links:
                        type: object
                        properties:
                          ebay:
                            type: string
                            example: https://rover.ebay.com/rover/1/711-53200-19255-0/1?...
                          comparison:
                            type: string
                            example: /v1/products/compare?keywords=Limited%20Edition%20Gaming%20Console
                      related_endpoints:
                        type: object
                        properties:
                          track:
                            type: string
                            example: /v1/products/track
                          history:
                            type: string
                            example: /v1/core/prices/history?product_id=165123456789
                          similar:
                            type: string
                            example: /v1/products/search?keywords=Limited%20Edition%20Gaming%20Console
                  timestamp:
                    type: string
                    format: date-time
                    example: 2024-01-15T12:34:56.000Z
        '400':
          description: Product identifier missing
          content:
            application/json:
              example:
                success: false
                error: Product ID is required
        '404':
          description: Product not found on the upstream marketplace
          content:
            application/json:
              example:
                success: false
                error: Product not found
                product_id: 165123456789
        '500':
          description: Unexpected error retrieving product details
          content:
            application/json:
              example:
                success: false
                error: Failed to fetch product details
                message: Unexpected error

    /v1/core/prices/alerts:
      get:
        tags:
        - Alerts
      summary: List price alerts
      description: Retrieve in-memory price alerts filtered by status or trigger state.
      operationId: getPriceAlerts
      parameters:
        - name: status
          in: query
          description: Filter alerts by status.
          schema:
            type: string
                        enum:
              - all
              - active
              - paused
              - cancelled
              - triggered
            default: all
        - name: triggered
          in: query
          description: Filter alerts by triggered state. Accepts `true` or `false`.
          schema:
            type: boolean
           
      responses:
        '200':
          description: List of price alerts
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                    count:
                    type: integer
                    example: 1
                  alerts:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: alert_1700000000000_abcd1234
                        product_url:
                          type: string
                          format: uri
                          example: https://www.ebay.com/itm/165123456789
                        target_price:
                          type: number
                          example: 179.99
                        alert_type:
                          type: string
                          example: price_drop
                        notification_channels:
                          type: array
                          items:
                            type: string
                          example:
                            - api
                        email:
                          type: string
                          nullable: true
                          example: shopper@example.com
                        webhook_url:
                          type: string
                          nullable: true
                        status:
                          type: string
                          example: active
                        created_at:
                          type: string
                          format: date-time
                        last_checked:
                          type: string
                          nullable: true
                        triggered:
                          type: boolean
                        triggered_at:
                          type: string
                          nullable: true
                        trigger_count:
                          type: integer
                          example: 0
                  summary:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 5
                      active:
                        type: integer
                        example: 3
                      triggered:
                        type: integer
                        example: 1
    post:
      tags:
        - Alerts
      summary: Create a price alert
      description: Register a new price alert for a specific product URL and target price.
      operationId: postPriceAlert
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - product_url
                - target_price
              properties:
                product_id:
                  type: string
                  format: uri
                  example: https://www.ebay.com/itm/165123456789
                target_price:
                  type: number
                  example: 179.99     
                alert_type:
                  type: string
                  enum:
                    - price_drop
                    - back_in_stock
                    - any_change
                  default: price_drop
                notification_channels:
                  type: array
                  items:
                    type: string
                    enum:
                      - api
                      - email
                      - webhook
                  default:
                    - api
                email:
                  type: string
                  format: email
                  nullable: true
                  example: shopper@example.com
                webhook_url:
                  type: string
                  format: uri
                  nullable: true
                  example: https://example.com/alerts/webhook
      responses:
        '201':
          description: Alert created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                    message:
                    type: string
                    example: Alert created successfully
                  alert:
                    type: object
                    properties:
                      id:
                        type: string
                        example: alert_1700000000000_abcd1234
                      product_url:
                        type: string
                        format: uri
                        example: https://www.ebay.com/itm/165123456789
                      target_price:
                        type: number
                        example: 179.99
                      alert_type:
                        type: string
                        example: price_drop
                      notification_channels:
                        type: array
                        items:
                          type: string
                        example:
                          - api
                          - email
                      email:
                        type: string
                        nullable: true
                        example: shopper@example.com
                      webhook_url:
                        type: string
                        nullable: true
                        example: https://example.com/alerts/webhook
                      status:
                        type: string
                        example: active
                      created_at:
                        type: string
                        format: date-time
                      last_checked:
                        type: string
                        nullable: true
                      triggered:
                        type: boolean
                        example: false
                      triggered_at:
                        type: string
                        nullable: true
                      trigger_count:
                        type: integer
                        example: 0
        '400':
          description: Missing required fields when creating an alert
          content:
            application/json:
              example:
                success: false
                error: Product URL and target price are required
    put:
      tags:
        - Alerts
      summary: Update a price alert
      description: Modify alert settings using the alert identifier provided as a query parameter.
      operationId: putPriceAlert
      parameters:
        - name: alert_id
          in: query
          description: Identifier of the alert to update.
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              description: Fields to update on the alert, such as `status`, `target_price`, or `notification_channels`.
      responses:
        '200':
          description: Alert updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Alert updated successfully
                  alert:
                    type: object
                    description: The alert after updates were applied.
        '400':
          description: Alert identifier missing from the request
          content:
            application/json:
              example:
                success: false
                error: Alert ID is required
        '404':
          description: Alert with the supplied identifier does not exist
          content:
            application/json:
              example:
                success: false
                error: Alert not found
    delete:
      tags:
        - Alerts
      summary: Delete a price alert
      description: Remove a stored alert by identifier.
      operationId: deletePriceAlert
      parameters:
        - name: alert_id
          in: query
          description: Identifier of the alert to delete.
          required: true
          schema:
            type: string

      responses:
        '200':
          description: Alert deleted successfully
          content:
            application/json:
              example:
                success: true
                message: Alert deleted successfully
        '400':
          description: Alert identifier missing from the request
          content:
            application/json:
              example:
                success: false
                error: Alert ID is required
        '404':
          description: Alert with the supplied identifier does not exist
          content:
            application/json:
              example:
                success: false
                error: Alert not found

components:
  schemas:
    Product:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        url:
          type: string
          format: uri
          example: https://www.amazon.com/dp/B08N5WRWNW
        name:
          type: string
          example: Echo Dot (4th Gen) | Smart speaker with Alexa
        current_price:
          type: number
          format: float
          example: 249.99
        original_price:
          type: number
          format: float
          example: 299.99
        lowest_price:
          type: number
          format: float
          example: 199.99
        highest_price:
          type: number
          format: float
          example: 349.99
        target_price:
          type: number
          format: float
          nullable: true
          example: 179.99
        currency:
          type: string
          example: USD
        store:
          type: string
          example: amazon.com
        image_url:
          type: string
          format: uri
          nullable: true
          example: https://m.media-amazon.com/images/I/71Q9d6N7xkL._AC_SL1000_.jpg
        in_stock:
          type: boolean
          example: true
        notify_on_drop:
          type: boolean
          example: false
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PriceHistory:
      type: object
      properties:
        price:
          type: number
          format: float
          example: 249.99
        in_stock:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time

    Alert:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product_id:
          type: string
          format: uuid
        target_price:
          type: number
          format: float
          example: 179.99
        alert_type:
          type: string
          enum: [price_drop, back_in_stock, any_change]
        notification_channels:
          type: array
          items:
            type: string
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: Invalid request
        message:
          type: string
          description: Detailed error message
          example: The provided URL is not valid
        details:
          type: object
          description: Additional error details
        request_id:
          type: string
          description: Unique request identifier for debugging
          example: req_abc123xyz
        timestamp:
          type: string
          format: date-time

    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: Validation error
        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                example: url
              message:
                type: string
                example: Invalid URL format
              code:
                type: string
                example: invalid_string

  responses:
    BadRequest:
      description: Bad request - Invalid input data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'
    
    Unauthorized:
      description: Unauthorized - Missing or invalid API key
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: Unauthorized
              message:
                type: string
                example: Missing X-RapidAPI-Key header
    
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: Product not found
    
    RateLimitExceeded:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: Rate limit exceeded
              message:
                type: string
                example: "Plan: free, Limit: 100/day"
              retry_after:
                type: integer
                description: Seconds until rate limit resets
                example: 3600
    
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: Internal server error
              message:
                type: string
                example: An unexpected error occurred
              request_id:
                type: string
                example: req_xyz789

  securitySchemes:
    RapidAPIKey:
      type: apiKey
      in: header
      name: X-RapidAPI-Key
      description: Your RapidAPI key for authentication
    
    RapidAPIHost:
      type: apiKey
      in: header
      name: X-RapidAPI-Host
      description: RapidAPI host (pricedropapi.p.rapidapi.com)

security:
  - RapidAPIKey: []
    RapidAPIHost: []

externalDocs:
  description: Full API Documentation
  url: https://pricedrop-api.vercel.app/docs